  @model IEnumerable<Sireed.APPLICATION.DTO.IndicateurDTO>
@{
    ViewData["Title"] = "Indicateurs par Région";
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

     <link href="~/css/indicateur/navbar.css" rel="stylesheet" />
 
    <!-- Bootstrap CSS (Version 3.4.1 ou plus récente) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- CSS de DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css">

    <!-- jQuery et DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>

    <style>
        /* Suppression de la marge par défaut et bordure arrondie de la navbar */
/*         .navbar {
            margin-bottom: 0;
            border-radius: 0;
        }
 */
        /* Footer avec fond gris et padding */
        footer {
            background-color: #f2f2f2;
            padding: 25px;
        }

        /* Styles personnalisés pour le DataTable */
        table.dataTable {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse !important;
        }

            table.dataTable thead th {
                background-color: transparent;
                color: black;
                padding: 12px 15px;
                text-align: left;
                font-weight: bold;
                border-bottom: 2px solid #ddd;
            }

            table.dataTable tbody tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            table.dataTable tbody tr:hover {
                background-color: #e0e0e0;
            }

            table.dataTable td {
                padding: 12px 15px;
                border-bottom: 1px solid #ddd;
            }

        div.dataTables_filter {
            float: right;
        }

        .jumbotron {
            padding-top: 7px;
            padding-bottom: 7px;
        }
    

        /* Styles généraux pour le corps et la section */
.content-body {
    background-color: #f4f5f7;
    padding: 20px;
    font-family: Arial, sans-serif;
}

.card {
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    background-color: #ffffff;
    margin-bottom: 20px;
    overflow: hidden;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
            background-color: #2b8a3e;
    color: #fff;
    padding: 15px;
    border-bottom: 1px solid #ddd;
    border-radius: 6px 6px 0 0;
}

.card-title {
    font-size: 1.25rem;
    font-weight: bold;
}

.heading-elements {
    display: flex;
    align-items: center;
}

.heading-elements ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
}

.heading-elements ul li {
    margin-left: 10px;
}

.heading-elements a {
    color: #ffffff;
    text-decoration: none;
    font-size: 1.2rem;
}

.heading-elements a:hover {
    color: #e9ecef;
}

.card-content {
    padding: 15px;
}

.height-400,
.height-500 {
    position: relative;
    height: 400px;
}

.height-500 {
    height: 500px;
}

/* Style pour les canvas des graphiques */
canvas {
    width: 100% !important;
    height: 100% !important;
    display: block;
}

/* Responsive */
/* media (max-width: 768px) {
    .card-header {
        flex-direction: column;
        text-align: center;
    }
    .heading-elements ul {
        justify-content: center;
        margin-top: 10px;
    }
}
 */

        /* Style général de la carte */
        .card {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #018749;
            color: #ffffff;
            padding: 15px;
            border-radius: 8px 8px 0 0;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
        }

        /* Boutons d'actions alignés à droite */
        .heading-elements {
            display: flex;
            align-items: center;
        }

            .heading-elements ul {
                display: flex;
                list-style: none;
                margin: 0;
                padding: 0;
            }

                .heading-elements ul li {
                    margin-left: 10px;
                }

            .heading-elements a {
                color: #ffffff;
                font-size: 1rem;
                text-decoration: none;
                cursor: pointer;
            }

                .heading-elements a:hover {
                    color: #e9ecef;
                }

        /* Style du contenu */
        .card-content {
            padding: 20px;
            background-color: #f8f9fa;
        }

        /* Zones pour les graphiques */
        .height-400,
        .height-500 {
            position: relative;
            height: 400px;
        }

        /* Cache le contenu quand la carte est réduite */
        .card-content.collapse {
            display: none;
        }

        /* Style pour agrandir la carte */
        .card.expanded {
            position: fixed;
            top: 10%;
            left: 10%;
            width: 80%;
            height: 80%;
            z-index: 1000;
        }

        /* Style du spinner pour l'effet de rechargement */
        .spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #018749;
        }

        .element {
            transform: scale(1.2); /* Adjust scale as needed */
            transform-origin: 0 0; /* Adjust the origin point as needed */
        }



       /*STYLE POUR PAGINATION DATATABLE*/

        .dataTables_paginate .paginate_button {
            border-radius: 10px !important;
            background-color: white !important;
            border: 1px solid #007bff !important;
            color: #007bff !important;
            padding: 0.5em 1em !important;
            margin-right: 5px !important;
            transition: background-color 0.3s, color 0.3s !important;
        }

            .dataTables_paginate .paginate_button:hover {
                background-color: green !important;
                color: white !important;
            }

            .dataTables_paginate .paginate_button.current {
                background-color: #007bff !important;
                color: white !important;
                
            }

            .dataTables_paginate .paginate_button.disabled {
                color: #ccc !important;
                pointer-events: none !important;
                background-color: white !important;
                border: 1px solid #ccc !important;
            }

            /*NAVBAR*/

      


    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <a href="#" class="nav-link">Home</a>
                <a href="#" class="nav-link">Privacy</a>
            </div>
            <div class="navbar-right">
                <a href="#" class="nav-link login-button">Connexion</a>
            </div>
            <div class="toggle" id="toggle-btn">&#9776;</div>
        </div>
    </nav>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const toggleBtn = document.getElementById("toggle-btn");

            const navbarContainer = document.querySelector(".navbar-container");


            toggleBtn.addEventListener("click", function () {

                navbarContainer.classList.toggle("active");

            });

        });
    </script>


     
    <!-- Jumbotron -->
    <div class="jumbotron text-center">
        <div class="container">
           @*  <h1>My Portfolio</h1>
            <p>Some text that represents "Me"...</p> *@
            <img src="https://www.mmsp.gov.ma/sites/default/files/fav.png" style="width:80px">
            
        </div>
    </div>



    <!-- Exemples de cartes -->
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">Indicateurs</h4>
            <div class="heading-elements">
                <ul class="list-inline mb-0">
                    <li><a data-action="collapse"><i class="ft-minus"><i class="fa-regular fa-window-minimize"></i></i></a></li>
                    <li><a data-action="reload"><i class="ft-rotate-cw"><i class="fa-duotone fa-solid fa-rotate-right fa-spin"></i></i></a></li>
                    <li><a data-action="expand"><i class="ft-maximize">⛶</i></a></li>
                    <li><a data-action="close"><i class="ft-x"><i class="fa-duotone fa-solid fa-rectangle-xmark fa-fade"></i></i></a></li>
                </ul>
            </div>
        </div>
        <div class="card-content">
            <div class="height-400">
                <!-- Contenu de la carte -->
                <!-- Tableau DataTables -->
                <!-- Tableau DataTables -->
                <div class="container-fluid" style="border-radius:10px">
                    <table id="example" class="display" style="border-radius:10px">
                        <thead>
                            <tr>
                                <th>Nom de la Région</th>
                                <th>Nom de l'Indicateur</th>
                                <th>Description de l'Indicateur</th>
                                <th>Superficie</th>
                                <th>Population</th>
                                <th>Description de la Région</th>
                                <th>Valeur</th>
                                <th>Type</th>
                                <th>Unité</th>
                                <th>Année</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Any())
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@item.RegionNomDTO</td>
                                        <td>@item.IndicateurNomDTO</td>
                                        <td>@item.IndicateurDescriptionDTO</td>
                                        <td>@item.SuperficieDTO</td>
                                        <td>@item.PopulationDTO</td>
                                        <td>@item.RegionDescriptionDTO</td>
                                        <td>@item.ValeurDTO</td>
                                        <td>@item.TypeDTO</td>
                                        <td>@item.UniteDTO</td>
                                        <td>@item.AnneeDTO</td>
                                        <td>
                                            <a href="#" class="btn btn-light" data-toggle="modal" data-target="#maModal" data-region="@item.RegionNomDTO"><i class="fa-solid fa-map-location-dot"></i></a>
                                            <a href="#" class="btn btn-light">

                                                <div style="margin-bottom: 15px;">

                                                    <label>@item.IndicateurNomDTO</label>

                                                    <div style="position: relative; height: 5px; width: 50%; background-color: #e0e0e0; border-radius: 5px;">


                                                        <div style="height: 100%; width: @item.PercentageDTO%; background-color: #4caf50; border-radius: 5px;"
                                                             title="Année: @item.AnneeDTO | Région: @item.RegionNomDTO | Nombre : @item.NombreIndicDTO">

                                                            <span style="position: absolute; right: 10px; color:forestgreen;">

                                                                @item.PercentageDTO%


                                                            </span>

                                                        </div>

                                                    </div>

                                                </div>
                                                
                                            </a>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
                <!-- Contenu de la carte -->
                <canvas id="column-chart" style="width: 100%; height: 100%;">
                  
                </canvas>
            </div>
        </div>
    </div>

    <script>

        document.querySelectorAll('.btn-light').forEach(btn => {

            btn.addEventListener('mouseover', function () {

                this.querySelector('.tooltiptext').style.display = 'block';

            });

            btn.addEventListener('mouseout', function () {

                this.querySelector('.tooltiptext').style.display = 'none';

            });

        });

    </script>

    <script>
        fetch('/Indicateurs/GetNombreIndic')
            .then(response => response.json())
            .then(data => {
                document.getElementById('nombreValue').innerText = data;

                var debugTest = document.getElementById('nombreValue');

                console.log(debugTest);


            })
            .catch(error => console.error('Erreur:', error));
    </script>

    <div style="height:50vh"></div>

    <!-- Fenêtre Modale -->
    <!-- Fenêtre Modale -->
    <!-- Fenêtre Modale -->
    <div class="modal fade" id="maModal" tabindex="-1" aria-labelledby="maModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="maModalLabel">Données de Population</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row h-100">
                            <!-- Tableau de données -->
                            <div class="col-md-6 h-50">
                                <h6>Tableau de Données</h6>
                                <table class="table table-bordered h-100">
                                    <thead>
                                        <tr>
                                            <th>Commune</th>
                                            <th>Population</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Maaziz (CR)</td>
                                            <td>11502</td>
                                        </tr>
                                        <tr>
                                            <td>Oulmes (CR)</td>
                                            <td>18786</td>
                                        </tr>
                                        <tr>
                                            <td>Tiddas (CR)</td>
                                            <td>10047</td>
                                        </tr>
                                        <!-- Ajouter d'autres lignes si nécessaire -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Graphique (exemple d'une barre horizontale simple) -->
                            <div class="col-md-6 h-50">
                                <h6>Graphique de Population</h6>
                                <div class="chart-placeholder" style="width: 100%; height: 100%; background-color: lightgray;">
                                    <p class="text-center">[Graphique de population ici]</p>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3 h-50">
                            <!-- Carte -->
                            <div class="col-12 h-100">
                                <h6>Carte</h6>
                                <div class="map-placeholder" style="width: 100%; height: 100%; background-color: #e0e0e0;">
                                    <p class="text-center">[Carte interactive ici]</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>


    

    @* <div class="modal fade" id="maModal" tabindex="-1" aria-labelledby="maModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="maModalLabel">Données de Population</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <!-- Tableau de données -->
                            <div class="col-md-6">
                                <h6>Tableau de Données</h6>
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Commune</th>
                                            <th>Population</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Maaziz (CR)</td>
                                            <td>11502</td>
                                        </tr>
                                        <tr>
                                            <td>Oulmes (CR)</td>
                                            <td>18786</td>
                                        </tr>
                                        <tr>
                                            <td>Tiddas (CR)</td>
                                            <td>10047</td>
                                        </tr>
                                        <!-- Ajouter d'autres lignes si nécessaire -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Graphique (exemple d'une barre horizontale simple) -->
                            <div class="col-md-6">
                                <h6>Graphique de Population</h6>
                                <div style="width: 100%; height: 200px; background-color: lightgray;">
                                    <p class="text-center">[Graphique de population ici]</p>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <!-- Carte -->
                            <div class="col-12">
                                <h6>Carte</h6>
                                <div style="width: 100%; height: 300px; background-color: #e0e0e0;">
                                    <p class="text-center">[Carte interactive ici]</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div> *@


    <!-- Modal pour afficher le graphique -->
@*     <div class="modal fade" id="maModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Détails de l'Indicateur</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <canvas id="chartCanvas" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div> *@


    

  
    <!-- Footer -->
    <footer class="container-fluid text-center">
        <p>Footer Text</p>
    </footer>

    <!-- Bootstrap and jQuery JS -->
@*     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> *@

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

            let chart; // Global variable for the chart

            // Function to create the chart with dynamic data
            function createChart(labels, data) {
            const ctx = document.getElementById('chartCanvas').getContext('2d');

            if (chart) {
                chart.destroy(); // Destroy the old chart if it exists
            }

            chart = new Chart(ctx, {
                type: 'bar',
            data: {
                labels: labels, // Labels (may be years, regions, etc.)
            datasets: [{
                label: 'Valeur de l\'indicateur',
            data: data, // Data values
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
                    }]
                },
            options: {
                responsive: true,
            scales: {
                y: {
                beginAtZero: true
                        }
                    }
                }
            });
        }

            // Trigger when the modal is shown
            $('#maModal').on('shown.bs.modal', function (event) {
            const button = $(event.relatedTarget);
            const regionNom = button.data('region').trim().toLowerCase(); // Name of the region

            // Fetch data via AJAX
            $.ajax({
                url: '/Indicateurs/GetIndicateursData', // Place your action URL here
            method: 'GET',
            success: function (data) {
                console.log("Données récupérées:", data); // Log the complete data

                    const filteredData = data.filter(item => item.RegionNomDTO && item.RegionNomDTO.trim().toLowerCase() === regionNom);

            if (filteredData.length === 0) {
                console.warn("Aucune donnée trouvée pour la région:", regionNom);
            return; // Do not continue if no data
                    }

                    // Prepare labels and values for the chart
                    const labels = filteredData.map(item => item.AnneeDTO);
                    const values = filteredData.map(item => item.ValeurDTO);

            // Create the chart with actual data
            createChart(labels, values);
                },
            error: function (err) {
                console.error("Erreur lors du chargement des données:", err);
                }
            });
        });


    </script>


    <!-- Initialisation de DataTables -->
    <script>
        $(document).ready(function () {
            $('#example').DataTable({
                "dom": 'Bfrtip',
                "paging": true,
                "autoWidth": true,
                "buttons": [
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Exporter en Excel',
                        className: 'custom-excel-button'  // Ajout d'une classe personnalisée
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'Exporter en PDF',
                        className: 'custom-pdf-button'    // Ajout d'une classe personnalisée
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimer',
                        className: 'custom-print-button'  // Ajout d'une classe personnalisée
                    }
                ]
            });
        });
    </script>

   @*  <script>
        $(document).ready(function () {
            $('#example').DataTable({
                "dom": 'Bfrtip',
                "paging": true,
                "autoWidth": true,
                "buttons": [
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fas fa-file-excel"></i>',
                        titleAttr: 'Exporter en Excel'
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fas fa-file-pdf"></i>',
                        titleAttr: 'Exporter en PDF'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i>',
                        titleAttr: 'Imprimer'
                    }
                ]
            });
        });
    </script> *@

    <!-- Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- SCRIPT CARTE -->
    <script>
        // Sélectionner toutes les cartes et leurs boutons d'action
        document.querySelectorAll('.card').forEach(card => {
            const collapseBtn = card.querySelector('[data-action="collapse"]');
            const reloadBtn = card.querySelector('[data-action="reload"]');
            const expandBtn = card.querySelector('[data-action="expand"]');
            const closeBtn = card.querySelector('[data-action="close"]');

            // Fonction de réduction de la carte
            collapseBtn.addEventListener('click', () => {
                const content = card.querySelector('.card-content');
                if (content.classList.contains('collapse')) {
                    content.classList.remove('collapse');
                    collapseBtn.querySelector('i').innerHTML = '<i class="fa-regular fa-window-minimize"></i>';
                } else {
                    content.classList.add('collapse');
                    collapseBtn.querySelector('i').textContent = '+';
                }
            });

            // Fonction de rechargement (simulé avec un spinner temporaire)
            reloadBtn.addEventListener('click', () => {
                const spinner = document.createElement('div');
                spinner.className = 'spinner';
                spinner.innerHTML = '<i class="fa-duotone fa-solid fa-spinner fa-spin"></i>';
                card.appendChild(spinner);

                setTimeout(() => {
                    card.removeChild(spinner); // Supprimer le spinner après 2 secondes
                }, 2000);
            });

            // Fonction pour agrandir ou réduire la carte
            expandBtn.addEventListener('click', () => {
                if (card.classList.contains('expanded')) {
                    card.classList.remove('expanded');
                    expandBtn.querySelector('i').innerHTML = '<i class="fa-duotone fa-solid fa-window-maximize"></i>';
                } else {
                    card.classList.add('expanded');
                    expandBtn.querySelector('i').textContent = '❐';
                }
            });

            // Fonction pour fermer la carte
            closeBtn.addEventListener('click', () => {
                card.style.display = 'none';
            });
        });
    </script>
</body>
</html>
